<app-header-superadmin></app-header-superadmin>
<div *ngIf="isMobile()" class="mobile-view-superadmin">
  <div class="header-info">
    <div class="title-icons">
      <div class="page-back" (click)="back()">
        <i class="bi bi-arrow-left"></i>
      </div>
    </div>
    <div class="d-flex">
      <div class="overflow-hidden">
        <h5 class="name simple">Demo Requests</h5>
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-add-section">
    <div class="search-container">
      <input type="text"
             class="search-input"
             placeholder="Search by name, email..."
             [(ngModel)]="searchTerm"
             (keyup.enter)="onSearch()">
      <button class="search-btn" (click)="onSearch()">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </div>

  <div class="container-fluid superadmin-content mt-3 px-3">
    <!-- Loading -->
    <div *ngIf="loading" class="p-2">
      <div class="skeleton-card" *ngFor="let i of [1,2,3]"></div>
    </div>

    <!-- No results -->
    <div *ngIf="!loading && demoRequests.length === 0" class="text-center py-5">
      <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.25;"></i>
      <p class="mt-3 mb-0 text-muted">No demo requests found</p>
    </div>

    <!-- Request Cards -->
    <div class="card request-card mb-3"
         *ngFor="let request of demoRequests; trackBy: trackById"
         (click)="viewDetails(request)">

      <!-- Status Circle -->
      <div class="status-container">
        <div class="status-circle" [style.background]="getStatusColor(request.status)">
          <i [class]="getStatusIcon(request.status)"></i>
        </div>
      </div>

      <!-- Title Section -->
      <div class="title-section">
        <span class="status-badge-mini" [style.background-color]="getStatusColor(request.status)">
          {{ request.statusName }}
        </span>
        <h3 class="contact-name">{{ request.fullName }}</h3>
        <p class="center-name">{{ request.centerName }}</p>
      </div>

      <!-- Bottom Section -->
      <div class="bottom-section">
        <div class="info-section">
          <span class="info-label">Children</span>
          <div class="info-value">
            <div class="info-icon">
              <i class="bi bi-people-fill"></i>
            </div>
            <span class="info-count">{{ request.numberOfChildren }}</span>
          </div>
        </div>
        <div class="info-section">
          <span class="info-label">Submitted</span>
          <div class="date-value">
            <i class="bi bi-clock"></i>
            <span>{{ getTimeAgo(request.createdAt) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div [class]="isMobile() ? 'd-none' : 'container-fluid mt-4'">
  <app-title-page *ngIf="!isMobile()"
    title="Demo Requests"
    [breadcrumbs]="breadcrumbs"
    [actions]="titleActions">
  </app-title-page>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="stats">
    <div class="stat-card stat-new">
      <div class="stat-icon">
        <i class="bi bi-star-fill"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats.newRequests }}</span>
        <span class="stat-label">New Requests</span>
      </div>
    </div>
    <div class="stat-card stat-contacted">
      <div class="stat-icon">
        <i class="bi bi-telephone-fill"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats.contacted }}</span>
        <span class="stat-label">Contacted</span>
      </div>
    </div>
    <div class="stat-card stat-scheduled">
      <div class="stat-icon">
        <i class="bi bi-calendar-check-fill"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats.scheduled }}</span>
        <span class="stat-label">Scheduled</span>
      </div>
    </div>
    <div class="stat-card stat-completed">
      <div class="stat-icon">
        <i class="bi bi-check-circle-fill"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats.completed }}</span>
        <span class="stat-label">Completed</span>
      </div>
    </div>
    <div class="stat-card stat-total">
      <div class="stat-icon">
        <i class="bi bi-graph-up"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ stats.thisMonth }}</span>
        <span class="stat-label">This Month</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <i class="bi bi-search"></i>
      <input
        type="text"
        placeholder="Search by name, email, or center..."
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()">
      <button *ngIf="searchTerm" class="clear-btn" (click)="searchTerm = ''; onSearch()">
        <i class="bi bi-x"></i>
      </button>
    </div>

    <div class="filter-group">
      <select [(ngModel)]="statusFilter" (change)="onStatusChange()">
        <option *ngFor="let option of statusOptions" [ngValue]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading demo requests...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && demoRequests.length === 0">
    <div class="empty-icon">
      <i class="bi bi-inbox"></i>
    </div>
    <h3>No Demo Requests</h3>
    <p>There are no demo requests matching your criteria.</p>
  </div>

  <!-- Request Table -->
  <div class="table-container" *ngIf="!loading && demoRequests.length > 0">
    <table class="requests-table">
      <thead>
        <tr>
          <th>Contact</th>
          <th>Center</th>
          <th>Location</th>
          <th>Children</th>
          <th>Status</th>
          <th>Submitted</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let request of demoRequests; trackBy: trackById" (click)="viewDetails(request)">
          <td class="contact-cell">
            <div class="contact-info">
              <span class="contact-name">{{ request.fullName }}</span>
              <span class="contact-email">{{ request.email }}</span>
            </div>
          </td>
          <td>
            <div class="center-info">
              <span class="center-name">{{ request.centerName }}</span>
              <span class="center-role">{{ request.jobTitle }}</span>
            </div>
          </td>
          <td>{{ request.country }}</td>
          <td>{{ request.numberOfChildren }}</td>
          <td>
            <span class="status-badge" [style.background-color]="getStatusColor(request.status)">
              <i [class]="getStatusIcon(request.status)"></i>
              {{ request.statusName }}
            </span>
          </td>
          <td>
            <span class="time-ago">{{ getTimeAgo(request.createdAt) }}</span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-action btn-view" (click)="viewDetails(request); $event.stopPropagation()" title="View Details">
                <i class="bi bi-eye"></i>
              </button>
              <button class="btn-action btn-delete" (click)="deleteRequest(request, $event)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button
      class="page-btn"
      [disabled]="currentPage === 1"
      (click)="goToPage(currentPage - 1)">
      <i class="bi bi-chevron-left"></i>
    </button>

    <button
      *ngFor="let page of getPageNumbers()"
      class="page-btn"
      [class.active]="page === currentPage"
      (click)="goToPage(page)">
      {{ page }}
    </button>

    <button
      class="page-btn"
      [disabled]="currentPage === totalPages"
      (click)="goToPage(currentPage + 1)">
      <i class="bi bi-chevron-right"></i>
    </button>

    <span class="page-info">
      Showing {{ (currentPage - 1) * pageSize + 1 }} - {{ currentPage * pageSize > totalCount ? totalCount : currentPage * pageSize }} of {{ totalCount }}
    </span>
  </div>

  <!-- Detail Modal -->
  <div class="modal-overlay" *ngIf="showDetailModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Demo Request Details</h2>
        <button class="close-btn" (click)="closeModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body" *ngIf="selectedRequest">
        <div class="detail-section">
          <h3>Contact Information</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Full Name</label>
              <span>{{ selectedRequest.fullName }}</span>
            </div>
            <div class="detail-item">
              <label>Email</label>
              <a [href]="'mailto:' + selectedRequest.email">{{ selectedRequest.email }}</a>
            </div>
            <div class="detail-item">
              <label>Phone</label>
              <a [href]="'tel:' + selectedRequest.phone">{{ selectedRequest.phone }}</a>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Center Details</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Center Name</label>
              <span>{{ selectedRequest.centerName }}</span>
            </div>
            <div class="detail-item">
              <label>Role</label>
              <span>{{ selectedRequest.jobTitle }}</span>
            </div>
            <div class="detail-item">
              <label>Country</label>
              <span>{{ selectedRequest.country }}</span>
            </div>
            <div class="detail-item">
              <label>Number of Children</label>
              <span>{{ selectedRequest.numberOfChildren }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Additional Info</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>How they heard about us</label>
              <span>{{ selectedRequest.hearAboutUs }}</span>
            </div>
            <div class="detail-item full-width" *ngIf="selectedRequest.comments">
              <label>Comments</label>
              <p class="comments-text">{{ selectedRequest.comments }}</p>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Status & Timeline</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Current Status</label>
              <span class="status-badge" [style.background-color]="getStatusColor(selectedRequest.status)">
                <i [class]="getStatusIcon(selectedRequest.status)"></i>
                {{ selectedRequest.statusName }}
              </span>
            </div>
            <div class="detail-item">
              <label>Submitted</label>
              <span>{{ formatDate(selectedRequest.createdAt) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedRequest.contactedAt">
              <label>First Contacted</label>
              <span>{{ formatDate(selectedRequest.contactedAt) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedRequest.completedAt">
              <label>Completed</label>
              <span>{{ formatDate(selectedRequest.completedAt) }}</span>
            </div>
          </div>
        </div>

        <div class="status-actions">
          <label>Update Status:</label>
          <div class="status-buttons">
            <button
              *ngFor="let option of statusOptions.slice(1)"
              class="status-btn"
              [class.active]="selectedRequest.status === option.value"
              [style.border-color]="option.color"
              [style.color]="selectedRequest.status === option.value ? '#fff' : option.color"
              [style.background-color]="selectedRequest.status === option.value ? option.color : 'transparent'"
              (click)="updateStatus(selectedRequest, option.value!)">
              <i [class]="option.icon"></i>
              {{ option.label }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
