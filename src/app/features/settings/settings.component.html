<div class="container-fluid mt-4">
  <app-title-page [title]="'SETTINGS.TITLE' | translate" [subtitle]="'SETTINGS.SUBTITLE' | translate" icon="bi bi-gear"
    [breadcrumbs]="breadcrumbs">
  </app-title-page>

  <div class="row">
    <div class="col-12 mb-4">
      <div class="card card-general shadow-sm">
        <div class="card-header py-3">
          <h5>
            <i class="bi bi-info-circle-fill"></i>
            {{ 'SETTINGS.BASIC_INFO' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label fw-bold">
                {{ 'SETTINGS.LANGUAGE' | translate }}
              </label>

              <p class="text-muted small mb-2">
                {{ 'SETTINGS.LANGUAGE_DESC' | translate }}
              </p>

              <ng-select class="form-input" [(ngModel)]="selectedLanguage" [items]="languages" bindValue="code"
                [clearable]="false" [searchable]="false" (change)="switchLanguage(selectedLanguage)">

                <!-- Valeur sélectionnée -->
                <ng-template ng-label-tmp let-item="item">
                  <div class="d-flex align-items-center gap-2">
                    <img [src]="item.flag" width="20" height="14" alt="{{ item.name }}" />
                    <span>{{ item.name }}</span>
                  </div>
                </ng-template>

                <!-- Options du dropdown -->
                <ng-template ng-option-tmp let-item="item">
                  <div class="d-flex align-items-center gap-2">
                    <img [src]="item.flag" width="20" height="14" alt="{{ item.name }}" />
                    <span>{{ item.name }}</span>
                  </div>
                </ng-template>

              </ng-select>
            </div>


            <div *ngIf="isAdmin" class="col-md-4 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.CURRENCY' | translate }}</label>
              <p class="text-muted small mb-2">{{ 'SETTINGS.CURRENCY_DESC' | translate }}</p>
              <ng-select class="form-input" [(ngModel)]="selectedCurrency" [items]="currencies" bindValue="code"
                [clearable]="false" [searchable]="true" (change)="onCurrencyChange()">
                <ng-template ng-label-tmp let-item="item">
                  {{ item.symbol }} - {{ item.name }} ({{ item.code }})
                </ng-template>
                <ng-template ng-option-tmp let-item="item">
                  {{ item.symbol }} - {{ item.name }} ({{ item.code }})
                </ng-template>
              </ng-select>
            </div>

            <div *ngIf="isAdmin" class="col-md-4 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.COUNTRY' | translate }}</label>
              <p class="text-muted small mb-2">{{ 'SETTINGS.COUNTRY_DESC' | translate }}</p>
              <ng-select class="form-input" [(ngModel)]="selectedCountry" [items]="countries" bindLabel="label"
                bindValue="code" [clearable]="false" [searchable]="true" (change)="onCountryChange()">
                                <!-- Valeur sélectionnée -->
                <ng-template ng-label-tmp let-item="item">
                  <div class="d-flex align-items-center gap-2">
                    <img [src]="item.flag" width="20" height="14" alt="{{ item.name }}" />
                    <span>{{ item.name }}</span>
                  </div>
                </ng-template>

                <!-- Options du dropdown -->
                <ng-template ng-option-tmp let-item="item">
                  <div class="d-flex align-items-center gap-2">
                    <img [src]="item.flag" width="20" height="14" alt="{{ item.name }}" />
                    <span>{{ item.name }}</span>
                  </div>
                </ng-template>
              </ng-select>
            </div>
            <div class="d-flex justify-content-end">
              <button class="action-btn custom-btn-2 btn-add-global-2 w-100" (click)="saveLanguage()">
                <i class="bi bi-floppy me-2"></i>{{ 'SETTINGS.SAVE' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isAdmin" class="col-12 mb-4">
      <div class="card card-general shadow-sm">
        <div class="card-header py-3">
          <h5 class="mb-0"><i class="bi bi-sliders me-2"></i>{{ 'SETTINGS.LEAVE_SETTINGS' | translate }}</h5>
        </div>
        <div class="card-body">
          <p class="text-muted mb-4">{{ 'SETTINGS.LEAVE_SETTINGS_DESC' | translate }}</p>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.DEFAULT_ANNUAL_LEAVE' | translate }}</label>
              <input type="number" class="form-control" [(ngModel)]="defaultAnnualLeaveDays" min="0" max="365">
              <small class="text-muted">{{ 'SETTINGS.DEFAULT_ANNUAL_LEAVE_HINT' | translate }}</small>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.DEFAULT_MEDICAL_LEAVE' | translate }}</label>
              <input type="number" class="form-control" [(ngModel)]="defaultMedicalLeaveDays" min="0" max="365">
              <small class="text-muted">{{ 'SETTINGS.DEFAULT_MEDICAL_LEAVE_HINT' | translate }}</small>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 py-3 d-flex justify-content-end">
          <button class="action-btn custom-btn-2 btn-add-global-2" (click)="saveLeaveSettings()">
            <i class="bi bi-floppy me-2"></i>{{ 'SETTINGS.SAVE_LEAVE_SETTINGS' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Notification Preferences Section -->
    <div class="col-12 mb-4">
      <div class="card card-general shadow-sm">
        <div class="card-header py-3">
          <h5 class="mb-0">
            <i class="bi bi-bell me-2"></i>
            {{ 'SETTINGS.NOTIFICATION_PREFERENCES' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <p class="text-muted mb-4">{{ 'SETTINGS.NOTIFICATION_PREFERENCES_DESC' | translate }}</p>
          <div class="row">
            <div *ngFor="let pref of notificationPreferences" class="col-md-6 mb-3">
              <div class="form-check form-switch d-flex align-items-start">
                <input class="form-check-input me-3 mt-1" type="checkbox"
                       [id]="'notif-' + pref.notificationType"
                       [(ngModel)]="pref.isEnabled"
                       [disabled]="pref.isCore">
                <label class="form-check-label" [for]="'notif-' + pref.notificationType">
                  <strong>{{ getNotificationTypeLabel(pref.notificationType) }}</strong>
                  <small class="d-block text-muted">
                    {{ getNotificationTypeDescription(pref.notificationType) }}
                  </small>
                </label>
              </div>
            </div>
          </div>
          <div *ngIf="notificationPreferences.length === 0" class="text-center py-3">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <span class="ms-2 text-muted">{{ 'GLOBAL.LOADING' | translate }}</span>
          </div>
        </div>
        <div class="card-footer bg-white border-0 py-3 d-flex justify-content-end">
          <button class="action-btn custom-btn-2 btn-add-global-2"
                  (click)="saveNotificationPreferences()"
                  [disabled]="savingPreferences || notificationPreferences.length === 0">
            <span *ngIf="!savingPreferences">
              <i class="bi bi-floppy me-2"></i>{{ 'SETTINGS.SAVE_NOTIFICATION_PREFERENCES' | translate }}
            </span>
            <span *ngIf="savingPreferences">
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              {{ 'SETTINGS.SAVING' | translate }}
            </span>
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="isAdmin" class="col-12 mb-4">
      <div class="card card-general border-0 shadow-sm">
        <div class="card-header py-3">
          <h5 class="mb-0">
            <i class="bi bi-tag"></i>
            {{ 'SETTINGS.PREFIXES' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <p class="text-muted mb-4">{{ 'SETTINGS.PREFIXES_DESC' | translate }}</p>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.CHILD_PREFIX' | translate }}</label>
              <input type="text" class="form-control" [(ngModel)]="childPrefix" (change)="onPrefixChange('child')"
                maxlength="20" placeholder="Child, Student, Player">
              <small class="text-muted">e.g., Child, Student, Player</small>
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.PARENT_PREFIX' | translate }}</label>
              <input type="text" class="form-control" [(ngModel)]="parentPrefix" (change)="onPrefixChange('parent')"
                maxlength="20" placeholder="Parent, Guardian">
              <small class="text-muted">e.g., Parent, Guardian</small>
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label fw-bold">{{ 'SETTINGS.EDUCATOR_PREFIX' | translate }}</label>
              <input type="text" class="form-control" [(ngModel)]="educatorPrefix" (change)="onPrefixChange('educator')"
                maxlength="20" placeholder="Educator, Teacher, Coach">
              <small class="text-muted">e.g., Educator, Teacher, Coach</small>
            </div>
          </div>
        </div>
        <div class="card-footer bg-white border-0 py-3 d-flex justify-content-end">
          <button class="action-btn custom-btn-2 btn-add-global-2" (click)="saveSettings()">
            <i class="bi bi-floppy me-2"></i>{{ 'SETTINGS.SAVE' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Delete Account Section -->
    <div class="col-12">
      <div class="card card-general border-0 shadow-sm border-danger">
        <div class="card-header py-3 bg-danger bg-opacity-10">
          <h5 class="mb-0 text-danger">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ 'SETTINGS.DANGER_ZONE' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
            <div class="mb-3 mb-md-0">
              <h6 class="fw-bold text-danger mb-1">{{ 'SETTINGS.DELETE_ACCOUNT' | translate }}</h6>
              <p class="text-muted mb-0 small">{{ 'SETTINGS.DELETE_ACCOUNT_DESC' | translate }}</p>
            </div>
            <button class="btn btn-outline-danger" (click)="confirmDeleteAccount()" [disabled]="deletingAccount">
              <i class="bi bi-trash me-2"></i>
              <span *ngIf="!deletingAccount">{{ 'SETTINGS.DELETE_ACCOUNT_BTN' | translate }}</span>
              <span *ngIf="deletingAccount">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                {{ 'SETTINGS.DELETING' | translate }}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>