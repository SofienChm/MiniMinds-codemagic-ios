<div class="container-fluid mt-4">
  <app-title-page
    [title]="appointment?.title || ('APPOINTMENTS_PAGE.DETAILS' | translate)"
    [subtitle]="'APPOINTMENTS_PAGE.DETAIL_SUBTITLE' | translate"
    [icon]="'bi bi-calendar-check'"
    [breadcrumbs]="breadcrumbs"
    [actions]="titleActions">
  </app-title-page>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'APPOINTMENTS_PAGE.LOADING' | translate }}</span>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage && !loading" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
  </div>

  <!-- Appointment Details -->
  <div *ngIf="appointment && !loading" class="row">
    <!-- Main Info Card -->
    <div class="col-lg-8">
      <div class="card card-general mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-info-circle me-2"></i>
            {{ 'APPOINTMENTS_PAGE.APPOINTMENT_INFO' | translate }}
          </h5>
          <span class="badge" [ngClass]="getStatusBadgeClass(appointment.status)">
            {{ appointment.status }}
          </span>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="detail-label">{{ 'APPOINTMENTS_PAGE.TITLE_LABEL' | translate }}</label>
              <p class="detail-value">{{ appointment.title }}</p>
            </div>
            <div class="col-md-6 mb-3">
              <label class="detail-label">{{ 'APPOINTMENTS_PAGE.TYPE' | translate }}</label>
              <p>
                <span class="badge" [ngClass]="getTypeBadgeClass(appointment.type)">
                  {{ appointment.type }}
                </span>
              </p>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="detail-label">{{ 'APPOINTMENTS_PAGE.DATE' | translate }}</label>
              <p class="detail-value">
                <i class="bi bi-calendar-event me-2 text-primary"></i>
                {{ appointment.appointmentDate | date:'fullDate' }}
              </p>
            </div>
            <div class="col-md-4 mb-3">
              <label class="detail-label">{{ 'APPOINTMENTS_PAGE.START_TIME' | translate }}</label>
              <p class="detail-value">
                <i class="bi bi-clock me-2 text-success"></i>
                {{ appointment.startTime }}
              </p>
            </div>
            <div class="col-md-4 mb-3">
              <label class="detail-label">{{ 'APPOINTMENTS_PAGE.END_TIME' | translate }}</label>
              <p class="detail-value">
                <i class="bi bi-clock-history me-2 text-warning"></i>
                {{ appointment.endTime }}
              </p>
            </div>
          </div>

          <div *ngIf="appointment.description" class="mb-3">
            <label class="detail-label">{{ 'APPOINTMENTS_PAGE.DESCRIPTION' | translate }}</label>
            <p class="detail-value description-box">{{ appointment.description }}</p>
          </div>
        </div>
      </div>

      <!-- Notes Card (if any) -->
      <div *ngIf="appointment.notes || appointment.rejectionReason" class="card card-general mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-sticky me-2"></i>
            {{ 'APPOINTMENTS_PAGE.NOTES_AND_FEEDBACK' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <div *ngIf="appointment.notes" class="mb-3">
            <label class="detail-label">{{ 'APPOINTMENTS_PAGE.MEETING_NOTES' | translate }}</label>
            <p class="detail-value notes-box">{{ appointment.notes }}</p>
          </div>
          <div *ngIf="appointment.rejectionReason" class="mb-3">
            <label class="detail-label text-danger">{{ 'APPOINTMENTS_PAGE.REJECTION_REASON' | translate }}</label>
            <p class="detail-value rejection-box">{{ appointment.rejectionReason }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Side Info -->
    <div class="col-lg-4">
      <!-- People Involved -->
      <div class="card card-general mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-people me-2"></i>
            {{ 'APPOINTMENTS_PAGE.PEOPLE_INVOLVED' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <div class="person-item mb-3" *ngIf="!isParent">
            <div class="person-icon bg-primary-light">
              <i class="bi bi-person-fill text-primary"></i>
            </div>
            <div class="person-info">
              <label class="detail-label mb-0">{{ 'APPOINTMENTS_PAGE.PARENT' | translate }}</label>
              <p class="detail-value mb-0">{{ appointment.parentName || '-' }}</p>
            </div>
          </div>

          <div class="person-item mb-3">
            <div class="person-icon bg-info-light">
              <i class="bi bi-person-heart text-info"></i>
            </div>
            <div class="person-info">
              <label class="detail-label mb-0">{{ 'APPOINTMENTS_PAGE.CHILD' | translate }}</label>
              <p class="detail-value mb-0">{{ appointment.childName || ('APPOINTMENTS_PAGE.NOT_SPECIFIED' | translate) }}</p>
            </div>
          </div>

          <div class="person-item">
            <div class="person-icon bg-success-light">
              <i class="bi bi-person-badge text-success"></i>
            </div>
            <div class="person-info">
              <label class="detail-label mb-0">{{ 'APPOINTMENTS_PAGE.TEACHER' | translate }}</label>
              <p class="detail-value mb-0">{{ appointment.teacherName || ('APPOINTMENTS_PAGE.ANY_AVAILABLE' | translate) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline -->
      <div class="card card-general">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-clock-history me-2"></i>
            {{ 'APPOINTMENTS_PAGE.TIMELINE' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker bg-primary"></div>
              <div class="timeline-content">
                <p class="timeline-label">{{ 'APPOINTMENTS_PAGE.CREATED' | translate }}</p>
                <p class="timeline-date">{{ appointment.createdAt | date:'medium' }}</p>
              </div>
            </div>

            <div *ngIf="appointment.processedAt" class="timeline-item">
              <div class="timeline-marker"
                   [class.bg-success]="appointment.status === 'Approved' || appointment.status === 'Completed'"
                   [class.bg-danger]="appointment.status === 'Rejected'"
                   [class.bg-secondary]="appointment.status === 'Cancelled'">
              </div>
              <div class="timeline-content">
                <p class="timeline-label">{{ appointment.status }}</p>
                <p class="timeline-date">{{ appointment.processedAt | date:'medium' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions for Parent -->
      <div *ngIf="isParent && (appointment.status === 'Pending' || appointment.status === 'Approved')" class="card card-general mt-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-lightning me-2"></i>
            {{ 'APPOINTMENTS_PAGE.QUICK_ACTIONS' | translate }}
          </h5>
        </div>
        <div class="card-body">
          <button *ngIf="appointment.status === 'Pending'"
                  class="btn btn-outline-primary w-100 mb-2"
                  [routerLink]="['/appointments/edit', appointment.id]">
            <i class="bi bi-pencil me-2"></i>{{ 'APPOINTMENTS_PAGE.EDIT_APPOINTMENT' | translate }}
          </button>
          <button class="btn btn-outline-danger w-100" (click)="cancelAppointment()">
            <i class="bi bi-x-circle me-2"></i>{{ 'APPOINTMENTS_PAGE.CANCEL_APPOINTMENT' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
