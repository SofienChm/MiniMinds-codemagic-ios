<div class="container-fluid mt-4">
  <app-title-page
    [title]="'QR_MANAGEMENT.TITLE' | translate">
  </app-title-page>
  <!-- Messages -->
  <div class="alert alert-success" *ngIf="successMessage">
    <i class="bi bi-check-circle-fill"></i>
    {{ successMessage }}
  </div>
  <div class="alert alert-error" *ngIf="errorMessage">
    <i class="bi bi-exclamation-circle-fill"></i>
    {{ errorMessage }}
  </div>

  <!-- QR Codes Section -->
  <div class="section qr-codes-section card card-general">
    <div class="section-header card-header">
      <h5><i class="bi bi-qr-code"></i> {{ 'QR_MANAGEMENT.QR_CODES' | translate }}</h5>
      <button class="custom-btn-2 btn-add-global-2" (click)="regenerateQrCodes()" [disabled]="regenerating">
        <i class="bi" [class.bi-arrow-clockwise]="!regenerating" [class.bi-hourglass-split]="regenerating"></i>
        {{ regenerating ? ('QR_MANAGEMENT.REGENERATING' | translate) : ('QR_MANAGEMENT.REGENERATE_ALL_BTN' | translate) }}
      </button>
    </div>

    <div class="qr-cards" *ngIf="!loadingQrCodes">
      <!-- Check-In QR Code -->
      <div class="qr-card check-in">
        <div class="qr-header">
          <i class="bi bi-box-arrow-in-right"></i>
          <h3>{{ 'QR_MANAGEMENT.CHECK_IN_QR_CODE' | translate }}</h3>
        </div>
        <div class="qr-body">
          <canvas #checkInCanvas></canvas>
        </div>
        <div class="qr-footer">
          <span class="qr-date" *ngIf="checkInQrCode">
            {{ 'QR_MANAGEMENT.CREATED' | translate }}: {{ formatDate(checkInQrCode.createdAt) }}
          </span>
          <button class="btn-print" (click)="printQrCode('checkIn')">
            <i class="bi bi-printer"></i> {{ 'QR_MANAGEMENT.PRINT' | translate }}
          </button>
        </div>
      </div>

      <!-- Check-Out QR Code -->
      <div class="qr-card check-out">
        <div class="qr-header">
          <i class="bi bi-box-arrow-right"></i>
          <h3>{{ 'QR_MANAGEMENT.CHECK_OUT_QR_CODE' | translate }}</h3>
        </div>
        <div class="qr-body">
          <canvas #checkOutCanvas></canvas>
        </div>
        <div class="qr-footer">
          <span class="qr-date" *ngIf="checkOutQrCode">
            {{ 'QR_MANAGEMENT.CREATED' | translate }}: {{ formatDate(checkOutQrCode.createdAt) }}
          </span>
          <button class="btn-print" (click)="printQrCode('checkOut')">
            <i class="bi bi-printer"></i> {{ 'QR_MANAGEMENT.PRINT' | translate }}
          </button>
        </div>
      </div>
    </div>

    <div class="loading" *ngIf="loadingQrCodes">
      <div class="spinner"></div>
      <p>{{ 'QR_MANAGEMENT.LOADING_QR_CODES' | translate }}</p>
    </div>
  </div>

  <!-- School Settings Section -->
  <div class="card card-general">
    <div class="card-header">
      <h5><i class="bi bi-geo-alt"></i> {{ 'QR_MANAGEMENT.SCHOOL_LOCATION_GEOFENCE' | translate }}</h5>
    </div>

    <div class="settings-form card-body">
      <div class="form-group">
        <label for="schoolName">{{ 'QR_MANAGEMENT.SCHOOL_NAME' | translate }}</label>
        <input type="text" id="schoolName" [(ngModel)]="settings.schoolName"
               [placeholder]="'QR_MANAGEMENT.SCHOOL_NAME_PLACEHOLDER' | translate">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="latitude">{{ 'QR_MANAGEMENT.LATITUDE' | translate }}</label>
          <input type="number" id="latitude" [(ngModel)]="settings.latitude"
                 step="0.000001" placeholder="e.g., 40.7128">
        </div>
        <div class="form-group">
          <label for="longitude">{{ 'QR_MANAGEMENT.LONGITUDE' | translate }}</label>
          <input type="number" id="longitude" [(ngModel)]="settings.longitude"
                 step="0.000001" placeholder="e.g., -74.0060">
        </div>
        <button class="btn-location" (click)="getCurrentLocation()" [title]="'QR_MANAGEMENT.USE_CURRENT_LOCATION' | translate">
          <i class="bi bi-crosshairs"></i>
        </button>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="radius">{{ 'QR_MANAGEMENT.GEOFENCE_RADIUS' | translate }}</label>
          <input type="number" id="radius" [(ngModel)]="settings.geofenceRadiusMeters"
                 min="10" max="1000" placeholder="100">
        </div>
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="settings.geofenceEnabled">
            <span class="checkmark"></span>
            {{ 'QR_MANAGEMENT.ENABLE_GEOFENCING' | translate }}
          </label>
          <small>{{ 'QR_MANAGEMENT.GEOFENCE_HINT' | translate }}</small>
        </div>
      </div>

      <div class="form-actions">
        <button class="custom-btn-2 btn-add-global-2" (click)="saveSettings()" [disabled]="savingSettings">
          <i class="bi" [class.bi-check-lg]="!savingSettings" [class.bi-hourglass-split]="savingSettings"></i>
          {{ savingSettings ? ('QR_MANAGEMENT.SAVING' | translate) : ('QR_MANAGEMENT.SAVE_SETTINGS' | translate) }}
        </button>
        <span class="save-success" *ngIf="settingsSaved">
          <i class="bi bi-check-circle-fill"></i> {{ 'QR_MANAGEMENT.SAVED' | translate }}
        </span>
      </div>
    </div>
  </div>

  <!-- Instructions Section -->
  <div class="section instructions-section card card-general">
    <div class="card-header section-header">
      <h5><i class="bi bi-info-circle"></i> {{ 'QR_MANAGEMENT.HOW_IT_WORKS' | translate }}</h5>
    </div>

    <div class="instructions-content">
      <div class="instruction-item">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>{{ 'QR_MANAGEMENT.STEP_1_TITLE' | translate }}</h4>
          <p>{{ 'QR_MANAGEMENT.STEP_1_DESC' | translate }}</p>
        </div>
      </div>

      <div class="instruction-item">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>{{ 'QR_MANAGEMENT.STEP_2_TITLE' | translate }}</h4>
          <p>{{ 'QR_MANAGEMENT.STEP_2_DESC' | translate }}</p>
        </div>
      </div>

      <div class="instruction-item">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>{{ 'QR_MANAGEMENT.STEP_3_TITLE' | translate }}</h4>
          <p>{{ 'QR_MANAGEMENT.STEP_3_DESC' | translate }}</p>
        </div>
      </div>

      <div class="instruction-item">
        <div class="step-number">4</div>
        <div class="step-content">
          <h4>{{ 'QR_MANAGEMENT.STEP_4_TITLE' | translate }}</h4>
          <p>{{ 'QR_MANAGEMENT.STEP_4_DESC' | translate }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
