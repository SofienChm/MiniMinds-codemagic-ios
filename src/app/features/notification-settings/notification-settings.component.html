<ion-content class="notification-settings-page">
  <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="parent-detailchild font-inter">
    <app-parent-child-header-simple
      [title]="'SETTINGS.NOTIFICATION_PREFERENCES' | translate"
    >
    </app-parent-child-header-simple>

    <div class="body container-fluid">
      <div class="main-information">
        <!-- Description -->
        <p class="description text-muted mb-4">
          {{ 'SETTINGS.NOTIFICATION_PREFERENCES_DESC' | translate }}
        </p>

        <!-- Skeleton Loading -->
        <div *ngIf="isLoading" class="preferences-list">
          <div *ngFor="let i of [1,2,3,4,5,6]" class="preference-card mb-3">
            <div class="d-flex align-items-center gap-3">
              <app-skeleton [height]="40" [width]="'40px'" borderRadius="8px"></app-skeleton>
              <div class="flex-grow-1">
                <app-skeleton [height]="18" [width]="'60%'" class="mb-2"></app-skeleton>
                <app-skeleton [height]="14" [width]="'80%'"></app-skeleton>
              </div>
              <app-skeleton [height]="24" [width]="'44px'" borderRadius="12px"></app-skeleton>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && notificationPreferences.length === 0" class="empty-state text-center py-5">
          <i class="bi bi-bell-slash" style="font-size: 48px; color: #ccc;"></i>
          <h3 class="mt-3">{{ 'SETTINGS.NO_PREFERENCES' | translate }}</h3>
        </div>

        <!-- Preferences List -->
        <div *ngIf="!isLoading && notificationPreferences.length > 0" class="preferences-list">
          <div *ngFor="let pref of notificationPreferences" class="preference-card mb-3">
            <div class="preference-icon" [ngClass]="'icon-' + pref.notificationType.toLowerCase()">
              <i [ngClass]="getIconClass(pref.notificationType)"></i>
            </div>
            <div class="preference-content">
              <h4 class="preference-title">{{ getNotificationTypeLabel(pref.notificationType) }}</h4>
              <p class="preference-description">{{ getNotificationTypeDescription(pref.notificationType) }}</p>
            </div>
            <div class="preference-toggle">
              <label class="switch">
                <input type="checkbox"
                       [(ngModel)]="pref.isEnabled"
                       [disabled]="pref.isCore">
                <span class="slider round"></span>
              </label>
            </div>
          </div>

          <!-- Save Button -->
          <div class="save-button-container mt-4">
            <button class="btn btn-primary btn-save w-100"
                    (click)="savePreferences()"
                    [disabled]="isSaving">
              <span *ngIf="!isSaving">
                <i class="bi bi-check-lg me-2"></i>
                {{ 'SETTINGS.SAVE_NOTIFICATION_PREFERENCES' | translate }}
              </span>
              <span *ngIf="isSaving">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                {{ 'SETTINGS.SAVING' | translate }}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
